<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<title>loongSSO--注册页面</title>
<meta http-equiv="Content-Type" content="text/html; charset=gbk">
<link href="reg.css" rel="stylesheet" type="text/css" />
  <script language="JavaScript">
  <!--
	
	var eInterval;
	var loong_status;
	var intervalCount;
	var maxIntervalCount;
	
	eInterval        = false;
	loong_status     = -1;
	intervalCount    = 0;
	maxIntervalCount = 100;
	
	var http_response_t = {
		HTTP_RESPONSE_EMAIL_NO            : 0,
		HTTP_RESPONSE_EMAIL_OK            : 1,
		HTTP_RESPONSE_LOGIN_OK            : 2,
		HTTP_RESPONSE_LOGOUT_OK           : 3,
		HTTP_RESPONSE_REGISTER_OK         : 4,
		HTTP_RESPONSE_VALIDATE_NO         : 5,
		HTTP_RESPONSE_VALIDATE_OK         : 6,
		HTTP_RESPONSE_USERNAME_NO         : 7,
		HTTP_RESPONSE_USERNAME_OK         : 8,
		HTTP_RESPONSE_PASSWORD_NO         : 9,
		HTTP_RESPONSE_EMAIL_EXISTS        : 10,
		HTTP_RESPONSE_UNKNOWN_TYPE        : 11,
		HTTP_RESPONSE_UNKNOWN_MODULE      : 12,
		HTTP_RESPONSE_USERNAME_EXISTS     : 13,
		HTTP_RESPONSE_EMAIL_NOT_EXISTS    : 14,
		HTTP_RESPONSE_USERNAME_NOT_EXISTS : 15
	};

	function is_code(code)
	{
		var i, c;
		if(code.length != 4)
		{
			alert("验证码是四位的");
			return false;
		}
		for(i=0; i < code.length; i++)
		{
			c = code.charAt(i);
			if( (c < "0" || c > "9") && (c < "a" || c > "z" ) && (c < "A" || c > "Z" ))
			{
				alert("验证码必须由小写字母或数字组成");
				return false;
			}
		}
		return true;
	}
	
	function is_password(str)
	{
		var i, c;
		if(str.length < 5 || str.length > 19)
		{
			alert("密码是6位以上,20位以上");
			return false;
		}
		for(i=0; i < str.length; i++)
		{
			c = str.charAt(i);
			if( (c < "0" || c > "9") && (c < "a" || c > "z" ) && (c < "A" || c > "Z" ))
			{
				alert("密码必须由小写字母或数字组成");
				return false;
			}
		}
		return true;
	}

	function match_password(pass1, pass2)
	{
		if(pass1 != pass2)
		{
			alert("两次输入的密码不一样,请重新输入");
			return false;
		}
		return true;
	}


	function isEmail(strEmail) 
	{
		if (strEmail.search(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/) != -1)
		{
			return true;
		}

		alert("电子邮件验证失败");
		return false;
	}

	function is_username(username)
	{
		var patrn = /^[a-zA-Z0-9\u4e00-\u9fa5]{2,20}$/; 


		if(!patrn.exec(username))
		{
			alert("用户名必须由中文\英文\数字");
			return false;
		}

		return true;
	}

	function loginIntervalProc()
	{
		var frm;

        if (loong_status == -1 && intervalCount < maxIntervalCount)
        {
            intervalCount++;
            return ;
        }
		
		switch (loong_status)
		{
			case http_response_t.HTTP_RESPONSE_EMAIL_EXISTS :
				alert("email 已存在");
				break;
			case http_response_t.HTTP_RESPONSE_USERNAME_EXISTS :
				alert("用户名 已存在");
				break;
			case http_response_t.HTTP_RESPONSE_USERNAME_NO :
				alert("用户名验证失败");
				break;
			case http_response_t.HTTP_RESPONSE_EMAIL_NO :
				alert("电子邮件验证失败");
				break;
			case http_response_t.HTTP_RESPONSE_PASSWORD_NO :
				alert("密码验证失败");
				break;
			case http_response_t.HTTP_RESPONSE_VALIDATE_NO :
				alert("验证码错误");
				break;
			case http_response_t.HTTP_RESPONSE_REGISTER_OK :
				alert("注册成功");
				window.location.href = "http://www.xxxabc.cn:8080/php.php";
				break;
			default:
				alert("验证超时");
		}
		
		frm = document.forms["loginform"];
		frm.elements["sub"].disabled = false;
		frm.elements["sub"].value    = "注册";

		clearInterval(eInterval);
		intervalCount = 0;
        eInterval     = false;
		login_status  = -1;
	}

	function load_script(url)
	{
		var newScript  = document.createElement("script");
		newScript.type = "text/javascript";
        newScript.src  = url + "&rand=" + Math.random();

		document.getElementsByTagName("head")[0].appendChild(newScript);
	}


	function disposal()
	{
		var url, frm, rc;
		frm  = document.forms["loginform"];

		rc = is_username(frm.elements["username"].value);
		if(!rc) return false;
		
		rc = is_password(frm.elements["password"].value);
		if(!rc) return false;
		
		rc = match_password(frm.elements["password"].value, frm.elements["pass"].value);
		if(!rc) return false;
		
		rc = isEmail(frm.elements["email"].value);
		if(!rc) return false;

		rc = is_code(frm.elements["code"].value);
		if(!rc) return false;


		url  = "http://www.test.com/?module=register&code=" + frm.elements["code"].value + "&username=" + frm.elements["username"].value + "&password=" + frm.elements["password"].value + "&email=" + frm.elements["email"].value;
		load_script(url);
		
		frm.elements["sub"].disabled = true;
		frm.elements["sub"].value    = "正在注册中,请等一下....";

	    eInterval = setInterval(function()
        {
            loginIntervalProc();
        }
        , 100);

		return false;
	}
  //-->
  </script>
</head>

<body>&#8730; &#935; &#215;
<div id="mainbodytop"></div>
<div id="loginclss">
<form method="post" onsubmit="return disposal();" name="loginform">
<p class="tishi"><font color="#0033CC"><b>loongSSO注册页面</b></font></p>
<dl class="biao">
<dt><span>注册登陆名：
  <input name="username" type="text" id="username" />
</span><span class="reg1" id="sps1">3～20个合法字符(包括大小写字母、数字、下划线、中文)，一旦注册成功用户名不能修改。</span>
</dt>
<!-- onchange -->
<dd>接受相关协议：
  <input name="acctiveme" type="radio" id="acctiveme" value="yes" /> 
  接受
  <input type="radio" name="acctiveme" id="acctiveme" value="no" /> 
  不接受 <a href="readgeze.html" target="_blank" class="toplink">相关协议</a> </dd>
<dt><span>注册密码：
  <input name="password" type="password" id="password" />
</span><span class="reg1" id="sps2">密码区分大小写，4～20个合法字符组成，请尽量使用英文字母加数字或符号的组合密码。</span>
</dt>
<dt><span>重复密码：
  <input name="pass" type="password" id="pass" />
</span><span class="reg1" id="sps3">请再输入一遍您上面输入的密码。</span>
</dt>
<dt><span>电子邮件：
  <input name="email" type="text" id="email" />
</span><span class="reg1" id="sps4">E-mail非常重要！这是我们与您联系的首选方式，以及接收我们的服务和取回密码的途径，请务必填写真实，并确认是您最常用的电子邮件。</span>
</dt>
<dd><span>验 证 码：
  <input name="code" type="text" id="code" size="6" maxlength="4" autocomplete="off" />&nbsp;&nbsp;<img style="cursor:pointer" src="http://www.test.com/?module=validate" id="codeImg" name="codeImg" alt="看不清楚?请点击刷新" onclick="this.src='http://www.test.com/?module=validate&rand='+Math.random();"/>
  </span><span class="reg1" id="sps5">验证码不区分大小!</span><font id="mycode" style="display:none ">d</font>
</dd>
<dt style="text-align:center ">
  <input type="submit" id="Submit" name="sub" value="注 册"/>
  <input type="reset" name="Submit2" onclick="resetall()" value="重 置" />
</dt>
</dl>
</form>
</div><div id="rightme">
<hr />
版权所有：loongSSO<br />
技术支持：七夜(李锦星) lijinxing@gmail.com
</div>

</body>
</html>
